<div class="viewer-wrapper">
  <div class="viewer-toolbar">
    <div class="import-tabs">
      <button
        type="button"
        class="import-tab"
        [class.active]="activeImportTab === 'ifc'"
        (click)="selectImportTab('ifc')">
        IFC
      </button>
      <button
        type="button"
        class="import-tab"
        [class.active]="activeImportTab === 'cityjson'"
        (click)="selectImportTab('cityjson')">
        CityJSON
      </button>
    </div>

    <div class="import-panel" *ngIf="activeImportTab === 'ifc'">
      <label class="import-button">
        <input
          type="file"
          class="import-input"
          accept=".ifc"
          (change)="onIfcFileSelected($event)" />
        <span>Import IFC</span>
      </label>
      <span class="import-hint">Convert IFC files before viewing.</span>
    </div>

    <div class="import-panel" *ngIf="activeImportTab === 'cityjson'">
      <label class="import-button">
        <input
          type="file"
          class="import-input"
          accept=".json,.cityjson"
          (change)="onCityjsonFileSelected($event)" />
        <span>Import CityJSON</span>
      </label>
      <span class="import-hint">Load an existing CityJSON scene.</span>
    </div>

    <div class="import-status" *ngIf="isImporting && importStatusText">{{ importStatusText }}</div>
    <div class="import-error" *ngIf="importError">{{ importError }}</div>
  </div>

  <div #viewerContainer class="viewer-container"></div>

  <div class="info-panel" *ngIf="selectedInfo">
    <div class="info-header">Selected Object</div>
    <div class="info-item">
      <strong>Object ID:</strong>
      <span>{{ selectedInfo.objectId }}</span>
    </div>
    <div class="info-item">
      <strong>Surface Type:</strong>
      <span>{{ selectedInfo.surfaceType }}</span>
    </div>
    <div class="info-item">
      <strong>Position:</strong>
      <span>{{ selectedInfo.position }}</span>
    </div>
  </div>

  <div class="hint">Click objects to select | Hover to highlight</div>

  <div class="inspector-backdrop" *ngIf="inspectorOpen">
    <div class="inspector-modal">
      <div class="inspector-header">
        <h2>IFC Import Inspector</h2>
        <button type="button" class="inspector-close" (click)="cancelInspector()">
          Ã—
        </button>
      </div>

      <div class="inspector-body">
        <section class="inspector-column inspector-list">
          <div class="section-title">IFC Objects</div>
          <div class="inspector-scroll">
            <div
              class="object-item"
              *ngFor="let editor of objectEditors; trackBy: trackObjectById"
              [class.selected]="editor.objectId === inspectorSelectedObjectId"
              (click)="selectInspectorObject(editor.objectId)">
              <div class="object-item-main">
                <input
                  type="checkbox"
                  [(ngModel)]="editor.include"
                  [ngModelOptions]="{ standalone: true }"
                  (click)="$event.stopPropagation()"
                  (change)="onIncludeToggle(editor)" />
                <span class="object-name">{{ editor.name || editor.objectId }}</span>
              </div>
              <div class="object-type">{{ editor.ifcType }}</div>
            </div>
          </div>
        </section>

        <section class="inspector-column inspector-details" *ngIf="selectedInspectorObject as inspector">
          <div class="section-title">Object Details</div>
          <label class="field">
            <span>Display Name</span>
            <input type="text" [(ngModel)]="inspector.name" [ngModelOptions]="{ standalone: true }" />
          </label>
          <div class="field read-only">
            <span>Express ID</span>
            <code>{{ inspector.expressID }}</code>
          </div>
          <div class="field read-only">
            <span>IFC Type</span>
            <code>{{ inspector.ifcType }}</code>
          </div>
          <label class="field">
            <span>CityJSON Attributes</span>
            <textarea
              [ngModel]="inspector.attributesText"
              (ngModelChange)="onAttributesTextChange(inspector, $event)"
              rows="10"></textarea>
          </label>
          <div class="field-error" *ngIf="inspector.parseError">{{ inspector.parseError }}</div>
          <details class="raw-field" *ngIf="inspector.rawIfc">
            <summary>IFC Raw Properties</summary>
            <pre>{{ inspector.rawIfc | json }}</pre>
          </details>
        </section>

        <section class="inspector-column inspector-metadata">
          <div class="section-title">CityJSON Metadata</div>
          <textarea
            [ngModel]="metadataText"
            (ngModelChange)="onMetadataTextChange($event)"
            rows="18"></textarea>
          <div class="field-error" *ngIf="metadataError">{{ metadataError }}</div>
        </section>
      </div>

      <div class="inspector-footer">
        <div class="inspector-error" *ngIf="inspectorError">{{ inspectorError }}</div>
        <div class="footer-actions">
          <button type="button" class="inspector-button ghost" (click)="cancelInspector()">Cancel</button>
          <button
            type="button"
            class="inspector-button primary"
            [disabled]="inspectorHasBlockingErrors"
            (click)="finalizeInspector()">
            Import To Viewer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
